# Story 03 전 세계의 DNS서버가 연대한다.

## 1. DNS 서버의 기본 동작

DNS 서버의 기본 동작은 클라이언트에서 조회 메시지를 받고, 내용에 응답하는 형태이다.

조회 메시지에는 이름, 클래스, 타입으로 이루어져 있다. 

![Untitled](https://user-images.githubusercontent.com/48992412/205469034-e04f9624-76ea-44d9-96f4-b02f71aa0c17.png)

위 그림을 한줄로 요약하자면 ‘**DNS 서버는 서버에 등록된 도메인명과 IP 주소의 대응표를 조사하여 IP 주소를 회답한다.’ 이다. 여기서 대응표는 리소스 레코드라고 한다.**

## 2. 도메인의 계층

1번에서의 예제는 한대의 DNS 서버에 모든 정보가 있는 경우를 가정하고 설명하였다.

그러나 현실에서 인터넷은 막대한 수의 서버가 있음으로 **정보를 분산시켜서 다수의 DNS 서버에 등록하고 다수의 DNS 서버가 연대하여 어디에 정보가 등록되어 있는지 찾는 구조이다.**

여기서 DNS 서버에 등록한 정보에는 모든 도메인이 계층적 구조를 가진다. 예를들어 www.lab.cyber.co.kr은 com이라는 도메인 아래에 cyber이라는 도메인, 그 아래 lab, 그 아래는 www 이라는 도메인을 가지는 것이다.

이렇게 계층화된 도메인은 각 DNS 서버에 배치된다. 

## 3. 담당 DNS 서버를 찾아 IP 주소를 가져온다.

여기서 중요한 것은 **액세스 대상의 웹 서버가 어느 DNS 서버에 등록되어 있는지를 찾아내는 방법이다.**

수많은 DNS 서버를 다 뒤질 수 없기 때문에 다음과 같은 방법을 고안하였다.

하위의 도메인을 담당하는 DNS서버의 IP 주소를 그 상위의 DNS 서버에 등록하고, 이런 방법을 최상위 까지 반복한다. 예를 들어, [lab.glasscom.com](http://lab.glasscom.com) 이라는 도메인을 담당하는 DNS 서버를 glasscom.com의 DNS 서버에 등록하고 그 다음은 com 도메인 까지 등록한다. 이렇게 하면 상위의 DNS 서버에 가면 하위의 DNS 서버의 IP를 알 수 있게 된다.

![Untitled 1](https://user-images.githubusercontent.com/48992412/205469039-01d330ef-135f-4f5e-9d50-a7830a5dc139.png)


## 4. DNS 서버는 캐시 기능으로 빠르게 회답할 수 있다.

DNS 서버는 한 번 조사한 이름을 캐시에 기록할 수 있는데 이렇게 된다면, 하위 DNS 서버까지 갈 필요 없이 빠르게 필요한 IP을 응답할 수 있을 것이다. 예를 들어 [glasscom.com](http://lab.glasscom.com) 도메인이 있는 DNS 서버에 캐시된 IP가 있다면 그 하위 DNS 서버로 갈 필요 없이 필요한 IP를 응답해 줄 것이다.

주의할 점은 캐시에 저장된 이후 등록된 정보가 바뀌는 경우가 있다.

##