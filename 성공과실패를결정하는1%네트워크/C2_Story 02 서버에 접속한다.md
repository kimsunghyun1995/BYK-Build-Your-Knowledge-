# Story 02 서버에 접속한다.

## 1. 접속의 의미

클라이언트에서 소켓을 만든 직후에는 아직 아무것도 기록되어 있지 않으므로 통신에 대한 아무런 정보가 없다.

서버(목적지)의 IP주소나 포트 번호를 프로토콜 스택에 알리는 동작이 필요한데, 이것이 접속 동작의 한 가지 역할이다.

클라이언트와는 다르게 서버측은 목적지가 없기 때문에 IP주소나 포트 번호에 대한 정보를 알 수 없다. 그래서 클라이언트에서 자신의 IP 주소,포트 번호를 전달하면 서버측의 프로토콜 스택도 이에 대한 정보를 알 수 있다.

접속동작의 첫 번째 동작은 통신 상대와의 사이에 제어 정보를 주고받아 각자의 소켓에 필요한 정보를 기록하여, 데이터 송 수신 가능한 상태로 만든다. 여기서 제어 정보는 데이터 송 수신 동작을 제어하기 위한 정보이며, IP주소, 포트 번호가 대표적인 것 중 하나이다.

데이터 송 수신 동작을 실행할 때 송 수신하는 데이터를 일시적으로 저장하는 메모리 영역이 필요한데 이를 **버퍼 메모리**라 한다. 버퍼 메모리도 접속 동작을 할 때 실행되는데, 이것이 ‘접속’한다는 동작의 의미이다.

## 2. 맨 앞부분에 제어 정보를 기록한 헤더를 배치한다.

앞에서 말한 제어 정보는 아래 표와 같다.

![https://user-images.githubusercontent.com/48992412/208247639-ffaf14fa-ab33-44b4-863c-ecefd98f63d9.png](https://user-images.githubusercontent.com/48992412/208247639-ffaf14fa-ab33-44b4-863c-ecefd98f63d9.png)

이 제어 정보를 패킷의 맨 앞부분에 배치 하는 곳부터 헤더라고 부른다.

클라이언트와 서버는 이 헤더에 필요한 정보를 기록하여 통신 동작을 진행하고 있다.

데이터를 저장한 패킷은 **IP나 이더넷의 제어 정보, TCP의 제어 정보, 데이터 조각**으로 이루어져있고,

제어 정보만 있는 패킷은 **이더넷이나 IP의 제어 정보, TCP의 제어 정보로 이루어져 있다.**

결과적으로 통신 동작에 이용하는 제어 정보는 다음의 두 종류이다.

- 헤더에 기입되는 정보
- 소켓(프로토콜 스택의 메모리 영역)에 기록되는 정보

### 3. 접속 동작의 실제

접속 동작은 Socket 라이브러리의 Connect 메서드를 호출하는 곳부터 시작한다.

```java
Connect<디스크립터>, <서버측의 IP 주소와 포트번호>, ...
```

여기서 서버측의 IP 주소와 포트번호를 쓰면 프로토콜 스택의 TCP 담당 부분에 전달된다.